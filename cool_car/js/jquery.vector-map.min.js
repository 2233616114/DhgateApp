/*!
 * jVectorMap version 0.1
 *
 * Copyright 2011, Kirill Lebedev
 * Licensed under the MIT license.
 *
 */(function(g){var p={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1},l={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick"};g.fn.vectorMap=function(a){var b={map:"world_en",backgroundColor:"#F0FFFF",color:"#ffffff",hoverColor:"#00CCFF",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear"},c;if("addMap"===a)h.maps[arguments[1]]=arguments[2];else if("set"===a&&p[arguments[1]])this.data("mapObject")["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(this.data("mapObject"),Array.prototype.slice.call(arguments,2));else{g.extend(b,a);b.container=this;this.css({position:"relative",overflow:"hidden"});c=new h(b);this.data("mapObject",c);for(var d in l)b[d]&&this.bind(l[d]+".jvectormap",b[d])}};var m=function(a,b){this.mode=window.SVGAngle?"svg":"vml";if("svg"==this.mode)this.createSvgNode=function(a){return document.createElementNS(this.svgns,a)};else{try{document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),this.createVmlNode=function(a){return document.createElement("\x3crvml:"+a+' class\x3d"rvml"\x3e')}}catch(c){this.createVmlNode=function(a){return document.createElement("\x3c"+a+' xmlns\x3d"urn:schemas-microsoft.com:vml" class\x3d"rvml"\x3e')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}"svg"==this.mode?this.canvas=this.createSvgNode("svg"):(this.canvas=this.createVmlNode("group"),this.canvas.style.position="absolute");this.setSize(a,b)};m.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(a,b){if("svg"==this.mode)this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b);else if(this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.canvas.coordsize=a+" "+b,this.canvas.coordorigin="0 0",this.rootGroup){for(var c=this.rootGroup.getElementsByTagName("shape"),d=0,f=c.length;d<f;d++)c[d].coordsize=a+" "+b,c[d].style.width=a+"px",c[d].style.height=b+"px";this.rootGroup.coordsize=a+" "+b;this.rootGroup.style.width=a+"px";this.rootGroup.style.height=b+"px"}this.width=a;this.height=b},createPath:function(a){var b;"svg"==this.mode?(b=this.createSvgNode("path"),b.setAttribute("d",a.path),b.setFill=function(a){this.setAttribute("fill",a)},b.getFill=function(a){return this.getAttribute("fill")},b.setOpacity=function(a){this.setAttribute("fill-opacity",a)}):(b=this.createVmlNode("shape"),b.coordorigin="0 0",b.coordsize=this.width+" "+this.height,b.style.width=this.width+"px",b.style.height=this.height+"px",b.fillcolor=h.defaultFillColor,b.stroked=!1,b.path=m.pathSvgToVml(a.path),a=this.createVmlNode("skew"),a.on=!0,a.matrix="0.01,0,0,0.01,0,0",a.offset="0,0",b.appendChild(a),a=this.createVmlNode("fill"),b.appendChild(a),b.setFill=function(a){this.getElementsByTagName("fill")[0].color=a},b.getFill=function(a){return this.getElementsByTagName("fill")[0].color},b.setOpacity=function(a){this.getElementsByTagName("fill")[0].opacity=parseInt(100*a)+"%"});return b},createText:function(a){var b,c;if("svg"==this.mode){c=a.x;var d=a.y;void 0!=c&&void 0!=d&&""!=c&&""!=d&&(b=this.createSvgNode("text"),b.setAttribute("x",c),b.setAttribute("y",d),b.setAttribute("id","text_"+a.name),b.setAttribute("style",a.style),c=this.createSvgNode("tspan"),g(c).text(a.name),g(c).appendTo(b))}return b},createGroup:function(a){var b;"svg"==this.mode?b=this.createSvgNode("g"):(b=this.createVmlNode("group"),b.style.width=this.width+"px",b.style.height=this.height+"px",b.style.left="0px",b.style.top="0px",b.coordorigin="0 0",b.coordsize=this.width+" "+this.height);a&&(this.rootGroup=b);return b},applyTransformParams:function(a,b,c){"svg"==this.mode?this.rootGroup.setAttribute("transform","scale("+a+") translate("+b+", "+c+")"):(this.rootGroup.coordorigin=this.width-b+","+(this.height-c),this.rootGroup.coordsize=this.width/a+","+this.height/a)}};m.pathSvgToVml=function(a){var b=0,c=0,d,f;return a.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(a,g,e,h){e=e.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");e[0]||e.shift();a=0;for(h=e.length;a<h;a++)e[a]=Math.round(100*e[a]);switch(g){case "m":return b+=e[0],c+=e[1],"t"+e.join(",");case "M":return b=e[0],c=e[1],"m"+e.join(",");case "l":return b+=e[0],c+=e[1],"r"+e.join(",");case "L":return b=e[0],c=e[1],"l"+e.join(",");case "h":return b+=e[0],"r"+e[0]+",0";case "H":return b=e[0],"l"+b+","+c;case "v":return c+=e[0],"r0,"+e[0];case "V":return c=e[0],"l"+b+","+c;case "c":return d=b+e[e.length-4],f=c+e[e.length-3],b+=e[e.length-2],c+=e[e.length-1],"v"+e.join(",");case "C":return d=e[e.length-4],f=e[e.length-3],b=e[e.length-2],c=e[e.length-1],"c"+e.join(",");case "s":return e.unshift(c-f),e.unshift(b-d),d=b+e[e.length-4],f=c+e[e.length-3],b+=e[e.length-2],c+=e[e.length-1],"v"+e.join(",");case "S":return e.unshift(c+c-f),e.unshift(b+b-d),d=e[e.length-4],f=e[e.length-3],b=e[e.length-2],c=e[e.length-1],"c"+e.join(",")}return""}).replace(/z/g,"")};var h=function(a){a=a||{};var b=this,c=h.maps[a.map],d=c.style;this.container=a.container;this.defaultWidth=c.width;this.defaultHeight=c.height;this.color=a.color;this.hoverColor=a.hoverColor;this.setBackgroundColor(a.backgroundColor);this.width=a.container.width();this.height=a.container.height();this.resize();g(window).resize(function(){b.width=a.container.width();b.height=a.container.height();b.resize();b.canvas.setSize(b.width,b.height);b.applyTransform()});this.canvas=new m(this.width,this.height);a.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(!0);this.index=h.mapIndex;this.label=g("\x3cdiv/\x3e").addClass("jvectormap-label").appendTo(g("body"));g("\x3cdiv/\x3e").addClass("jvectormap-zoomin").text("+").appendTo(a.container);g("\x3cdiv/\x3e").addClass("jvectormap-zoomout").html("\x26#x2212;").appendTo(a.container);for(var f in c.pathes){var n=this.canvas.createPath({path:c.pathes[f].path}),l=this.canvas.createText({name:c.pathes[f].name,x:c.pathes[f].x,y:c.pathes[f].y,style:d});n.setFill(this.color);n.id="jvectormap"+b.index+"_"+f;b.countries[f]=n;g(this.rootGroup).append(n);g(this.rootGroup).append(l)}g(a.container).delegate("svg"==this.canvas.mode?"path":"shape","mouseover mouseout",function(e){var d=e.target,f=e.target.id.split("_").pop(),h=g.Event("labelShow.jvectormap"),k=g.Event("regionMouseOver.jvectormap");"mouseover"==e.type?(g(a.container).trigger(k,[f]),k.isDefaultPrevented()||(a.hoverOpacity&&d.setOpacity(a.hoverOpacity),a.hoverColor&&(d.currentFillColor=d.getFill()+"",d.setFill(a.hoverColor))),b.label.html(c.pathes[f].name),g(a.container).trigger(h,[b.label,f]),h.isDefaultPrevented()||(b.label.show(),b.labelWidth=b.label.width(),b.labelHeight=b.label.height())):(d.setOpacity(1),d.currentFillColor&&d.setFill(d.currentFillColor),b.label.hide(),g(a.container).trigger("regionMouseOut.jvectormap",[f]))});g(a.container).delegate("svg"==this.canvas.mode?"path":"shape","click",function(b){b=b.target.id.split("_").pop();g(a.container).trigger("regionClick.jvectormap",[b])});a.container.mousemove(function(a){b.label.is(":visible")&&b.label.css({left:a.pageX-15-b.labelWidth,top:a.pageY-15-b.labelHeight})});this.setColors(a.colors);this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new k(a.scaleColors,a.normalizeFunction,a.valueMin,a.valueMax);a.values&&(this.values=a.values,this.setValues(a.values));this.bindZoomButtons();h.mapIndex++};h.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(a,b){if("string"==typeof a)this.countries[a].setFill(b);else for(var c in a)this.countries[c]&&this.countries[c].setFill(a[c])},setValues:function(a){var b=0,c=Number.MAX_VALUE,d,f;for(f in a)d=parseFloat(a[f]),d>b&&(b=a[f]),d&&d<c&&(c=d);this.colorScale.setMin(c);this.colorScale.setMax(b);b={};for(f in a)d=parseFloat(a[f]),b[f]=d?this.colorScale.getColor(d):this.color;this.setColors(b);this.values=a},setBackgroundColor:function(a){this.container.css("background-color",a)},setScaleColors:function(a){this.colorScale.setColors(a);this.values&&this.setValues(this.values)},setNormalizeFunction:function(a){this.colorScale.setNormalizeFunction(a);this.values&&this.setValues(this.values)},resize:function(){var a=this.baseScale;this.width/this.height>this.defaultWidth/this.defaultHeight?(this.baseScale=this.height/this.defaultHeight,this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)):(this.baseScale=this.width/this.defaultWidth,this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale));this.scale*=this.baseScale/a;this.transX*=this.baseScale/a;this.transY*=this.baseScale/a},reset:function(){this.countryTitle.reset();for(var a in this.countries)this.countries[a].setFill(h.defaultColor);this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var a,b,c;this.defaultWidth*this.scale<=this.width?(a=(this.width-this.defaultWidth*this.scale)/(2*this.scale),c=(this.width-this.defaultWidth*this.scale)/(2*this.scale)):(a=0,c=(this.width-this.defaultWidth*this.scale)/this.scale);this.defaultHeight*this.scale<=this.height?(b=(this.height-this.defaultHeight*this.scale)/(2*this.scale),minTransY=(this.height-this.defaultHeight*this.scale)/(2*this.scale)):(b=0,minTransY=(this.height-this.defaultHeight*this.scale)/this.scale);this.transY>b?this.transY=b:this.transY<minTransY&&(this.transY=minTransY);this.transX>a?this.transX=a:this.transX<c&&(this.transX=c);this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var a=!1,b,c,d=this;this.container.mousemove(function(f){a&&(d.transX-=(b-f.pageX)/d.scale,d.transY-=(c-f.pageY)/d.scale,d.applyTransform(),b=f.pageX,c=f.pageY);return!1}).mousedown(function(d){a=!0;b=d.pageX;c=d.pageY;return!1}).mouseup(function(){return a=!1})},bindZoomButtons:function(){var a=this,b=(g("#zoom").innerHeight()-12-30-6-7-6)/(this.zoomMaxStep-this.zoomCurStep);this.container.find(".jvectormap-zoomin").click(function(){a.zoomCurStep<a.zoomMaxStep&&(a.transX-=(a.width/a.scale-a.width/(a.scale*a.zoomStep))/2,a.transY-=(a.height/a.scale-a.height/(a.scale*a.zoomStep))/2,a.setScale(a.scale*a.zoomStep),a.zoomCurStep++,g("#zoomSlider").css("top",parseInt(g("#zoomSlider").css("top"))-b))});this.container.find(".jvectormap-zoomout").click(function(){1<a.zoomCurStep&&(a.transX+=(a.width/(a.scale/a.zoomStep)-a.width/a.scale)/2,a.transY+=(a.height/(a.scale/a.zoomStep)-a.height/a.scale)/2,a.setScale(a.scale/a.zoomStep),a.zoomCurStep--,g("#zoomSlider").css("top",parseInt(g("#zoomSlider").css("top"))+b))})},setScale:function(a){this.scale=a;this.applyTransform()},getCountryPath:function(a){return g("#"+a)[0]}};h.xlink="http://www.w3.org/1999/xlink";h.mapIndex=1;h.maps={};var k=function(a,b,c,d){a&&this.setColors(a);b&&this.setNormalizeFunction(b);c&&this.setMin(c);c&&this.setMax(d)};k.prototype={colors:[],setMin:function(a){this.clearMinValue=a;this.minValue="function"===typeof this.normalize?this.normalize(a):a},setMax:function(a){this.clearMaxValue=a;this.maxValue="function"===typeof this.normalize?this.normalize(a):a},setColors:function(a){for(var b=0;b<a.length;b++)a[b]=k.rgbToArray(a[b]);this.colors=a},setNormalizeFunction:function(a){"polynomial"===a?this.normalize=function(a){return Math.pow(a,0.2)}:"linear"===a?delete this.normalize:this.normalize=a;this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(a){"function"===typeof this.normalize&&(a=this.normalize(a));for(var b=[],c=0,d,f=0;f<this.colors.length-1;f++)d=this.vectorLength(this.vectorSubtract(this.colors[f+1],this.colors[f])),b.push(d),c+=d;c=(this.maxValue-this.minValue)/c;for(f=0;f<b.length;f++)b[f]*=c;f=0;for(a-=this.minValue;0<=a-b[f];)a-=b[f],f++;for(a=f==this.colors.length-1?this.vectorToNum(this.colors[f]).toString(16):this.vectorToNum(this.vectorAdd(this.colors[f],this.vectorMult(this.vectorSubtract(this.colors[f+1],this.colors[f]),a/b[f]))).toString(16);6>a.length;)a="0"+a;return"#"+a},vectorToNum:function(a){for(var b=0,c=0;c<a.length;c++)b+=Math.round(a[c])*Math.pow(256,a.length-c-1);return b},vectorSubtract:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]-b[d];return c},vectorAdd:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]+b[d];return c},vectorMult:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]*b;return c},vectorLength:function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c]*a[c];return Math.sqrt(b)}};k.arrayToRgb=function(a){for(var b="#",c,d=0;d<a.length;d++)c=a[d].toString(16),b+=1==c.length?"0"+c:c;return b};k.rgbToArray=function(a){a=a.substr(1);return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]}})(jQuery);